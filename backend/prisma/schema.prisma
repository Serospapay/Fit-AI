// Prisma schema for Fitness Trainer App

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Користувач
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  passwordHash  String
  name          String?
  age           Int?
  gender        String?   // male, female, other
  height        Float?    // см
  weight        Float?    // кг
  activityLevel String?   // sedentary, light, moderate, active, very_active
  goal          String?   // lose_weight, gain_muscle, maintain, endurance, definition
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  workouts      Workout[]
  nutritionLogs NutritionLog[]
  goals         Goal[]
  reminders     Reminder[]
  recommendations Recommendation[]
  workoutTemplates WorkoutTemplate[]
  
  @@map("users")
}

// Вправи (тільки назви для вибору)
model Exercise {
  id              String   @id @default(cuid())
  name            String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  workoutExercises WorkoutExercise[]
  
  @@unique([name])
  @@map("exercises")
}

// Тренування
model Workout {
  id          String    @id @default(cuid())
  userId      String
  date        DateTime  @default(now())
  type        String?   // strength, cardio, flexibility, balance, mixed
  duration    Int?      // хвилини
  notes       String?
  rating      Int?      // 1-5
  status      String?   @default("completed") // completed, planned, cancelled
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  exercises   WorkoutExercise[]

  @@index([userId, date])
  @@map("workouts")
}

// Вправи в тренуванні
model WorkoutExercise {
  id          String   @id @default(cuid())
  workoutId  String
  exerciseId String
  customName String?   // Користувацька назва вправи (якщо хоче задати сам)
  sets       Int?
  reps       Int?
  weight     Float?    // кг
  duration   Int?      // секунди (для кардіо)
  distance   Float?    // км (для бігу)
  rest       Int?     // секунди відпочинку
  order      Int       @default(0)
  notes      String?

  workout    Workout   @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  exercise   Exercise  @relation(fields: [exerciseId], references: [id])

  @@index([workoutId])
  @@map("workout_exercises")
}

// Щоденник харчування
model NutritionLog {
  id          String    @id @default(cuid())
  userId      String
  date        DateTime  @default(now())
  mealType   String    // breakfast, lunch, dinner, snack
  createdAt   DateTime  @default(now())
  updatedAt   DateTime @updatedAt

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  items       NutritionItem[]

  @@index([userId, date])
  @@map("nutrition_logs")
}

// Продукти в щоденнику
model NutritionItem {
  id            String    @id @default(cuid())
  nutritionLogId String
  name          String
  nameUk        String?
  amount        Float     // грами
  calories      Float
  protein       Float     @default(0)
  carbs         Float     @default(0)
  fat           Float     @default(0)
  fiber         Float?    @default(0)
  createdAt     DateTime  @default(now())

  nutritionLog  NutritionLog @relation(fields: [nutritionLogId], references: [id], onDelete: Cascade)

  @@index([nutritionLogId])
  @@map("nutrition_items")
}

// База продуктів
model Food {
  id          String   @id @default(cuid())
  name        String
  nameUk      String?
  brand       String?
  category    String?  // fruit, vegetable, meat, dairy, grain, etc.
  calories    Float    // на 100г
  protein     Float    @default(0)
  carbs       Float    @default(0)
  fat         Float    @default(0)
  fiber       Float?   @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([name])
  @@map("foods")
}

// Мотиваційні цитати
model Quote {
  id          String   @id @default(cuid())
  text        String
  author      String?
  category    String?  // motivation, fitness, nutrition, health
  createdAt   DateTime @default(now())

  @@map("quotes")
}

// Цілі користувача
model Goal {
  id          String    @id @default(cuid())
  userId      String
  title       String
  description String?
  category    String    // weight, strength, endurance, nutrition, custom
  targetValue Float?
  currentValue Float?   @default(0)
  unit        String?   // кг, кг, км, дні, тощо
  startDate   DateTime  @default(now())
  targetDate  DateTime?
  status      String    @default("active") // active, completed, cancelled, paused
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@map("goals")
}

// Нагадування
model Reminder {
  id          String    @id @default(cuid())
  userId      String
  type        String    // workout, nutrition, water, custom
  title       String
  message     String?
  time        String    // HH:MM формат
  daysOfWeek  String    // JSON array: [0,1,2,3,4,5,6] де 0=неділя
  enabled     Boolean   @default(true)
  timezone    String?   @default("UTC")
  startDate   DateTime? @map("start_date")
  repeatFrequency String? @map("repeat_frequency") // once, daily, weekly, custom
  repeatInterval  Int? @default(1) @map("repeat_interval")
  repeatEndsAt DateTime? @map("repeat_ends_at")
  notificationChannel String? @default("browser") @map("notification_channel")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, enabled])
  @@map("reminders")
}

// Рекомендації
model Recommendation {
  id          String    @id @default(cuid())
  userId      String
  type        String    // workout, nutrition, progress, motivation
  title       String
  message     String
  priority    String    @default("normal") // low, normal, high
  isRead      Boolean   @default(false)
  createdAt   DateTime  @default(now())

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isRead, createdAt])
  @@map("recommendations")
}

// Шаблони тренувань
model WorkoutTemplate {
  id          String    @id @default(cuid())
  userId      String
  name        String
  description String?
  type        String?   // strength, cardio, flexibility, balance, mixed
  exercises   Json      // Array of exercise objects
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("workout_templates")
}
