// Prisma schema for Fitness Trainer App

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Користувач
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  passwordHash  String
  name          String?
  age           Int?
  gender        String?   // male, female, other
  height        Float?    // см
  weight        Float?    // кг
  activityLevel String?   // sedentary, light, moderate, active, very_active
  goal          String?   // lose_weight, gain_muscle, maintain, endurance, definition
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  workouts      Workout[]
  nutritionLogs NutritionLog[]
  
  @@map("users")
}

// Вправи (тільки назви для вибору)
model Exercise {
  id              String   @id @default(cuid())
  name            String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  workoutExercises WorkoutExercise[]
  
  @@unique([name])
  @@map("exercises")
}

// Тренування
model Workout {
  id          String    @id @default(cuid())
  userId      String
  date        DateTime  @default(now())
  type        String?   // strength, cardio, flexibility, balance, mixed
  duration    Int?      // хвилини
  notes       String?
  rating      Int?      // 1-5
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  exercises   WorkoutExercise[]

  @@index([userId, date])
  @@map("workouts")
}

// Вправи в тренуванні
model WorkoutExercise {
  id          String   @id @default(cuid())
  workoutId  String
  exerciseId String
  customName String?   // Користувацька назва вправи (якщо хоче задати сам)
  sets       Int?
  reps       Int?
  weight     Float?    // кг
  duration   Int?      // секунди (для кардіо)
  distance   Float?    // км (для бігу)
  rest       Int?     // секунди відпочинку
  order      Int       @default(0)
  notes      String?

  workout    Workout   @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  exercise   Exercise  @relation(fields: [exerciseId], references: [id])

  @@index([workoutId])
  @@map("workout_exercises")
}

// Щоденник харчування
model NutritionLog {
  id          String    @id @default(cuid())
  userId      String
  date        DateTime  @default(now())
  mealType   String    // breakfast, lunch, dinner, snack
  createdAt   DateTime  @default(now())
  updatedAt   DateTime @updatedAt

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  items       NutritionItem[]

  @@index([userId, date])
  @@map("nutrition_logs")
}

// Продукти в щоденнику
model NutritionItem {
  id            String    @id @default(cuid())
  nutritionLogId String
  name          String
  nameUk        String?
  amount        Float     // грами
  calories      Float
  protein       Float     @default(0)
  carbs         Float     @default(0)
  fat           Float     @default(0)
  fiber         Float?    @default(0)
  createdAt     DateTime  @default(now())

  nutritionLog  NutritionLog @relation(fields: [nutritionLogId], references: [id], onDelete: Cascade)

  @@index([nutritionLogId])
  @@map("nutrition_items")
}

// База продуктів
model Food {
  id          String   @id @default(cuid())
  name        String
  nameUk      String?
  brand       String?
  category    String?  // fruit, vegetable, meat, dairy, grain, etc.
  calories    Float    // на 100г
  protein     Float    @default(0)
  carbs       Float    @default(0)
  fat         Float    @default(0)
  fiber       Float?   @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([name])
  @@map("foods")
}
